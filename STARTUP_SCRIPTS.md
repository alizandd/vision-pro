# Startup Scripts / اسکریپت‌های شروع

راهنمای استفاده از اسکریپت‌های خودکار برای شروع و توقف سرورها

---

## 🍎 Mac / Linux

### شروع همه سرورها:
```bash
./start-all.sh
```

### متوقف کردن همه سرورها:
```bash
./stop-all.sh
```

### مثال:
```bash
cd vision-pro
./start-all.sh
```

خروجی:
```
╔════════════════════════════════════════════════════════════╗
║        Vision Pro - Starting All Servers                  ║
╚════════════════════════════════════════════════════════════╝

🔍 Detected IP Address: 192.168.88.250

🚀 Starting servers...

✅ WebSocket Server started
✅ Web Controller started

╔════════════════════════════════════════════════════════════╗
║                    🎉 SERVERS READY                        ║
╚════════════════════════════════════════════════════════════╝

┌────────────────────────────────────────────────────────────┐
│  📱 Open on Mobile/Tablet:                                 │
│                                                            │
│     http://192.168.88.250:3000                            │
│                                                            │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  🔌 WebSocket Server URL (enter in web app):              │
│                                                            │
│     ws://192.168.88.250:8080                              │
│                                                            │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  🎥 Vision Pro App Settings:                               │
│                                                            │
│     ws://192.168.88.250:8080                              │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

## 🪟 Windows

### شروع همه سرورها:
```cmd
start-all.bat
```

### متوقف کردن همه سرورها:
```cmd
stop-all.bat
```

### مثال:
```cmd
cd vision-pro
start-all.bat
```

خروجی مشابه نسخه Mac خواهد بود با آدرس‌های IP مربوط به Windows شما.

---

## 📋 اطلاعات نمایش داده شده

اسکریپت‌ها به طور خودکار این اطلاعات را نمایش می‌دهند:

### 1. آدرس وب اپ برای موبایل/تبلت
- به این آدرس در مرورگر موبایل بروید
- مثال: `http://192.168.88.250:3000`

### 2. آدرس WebSocket برای وب اپ
- این آدرس را داخل وب اپ در قسمت "Server Connection" وارد کنید
- مثال: `ws://192.168.88.250:8080`

### 3. آدرس برای Vision Pro
- این آدرس را در تنظیمات اپلیکیشن Vision Pro وارد کنید
- مثال: `ws://192.168.88.250:8080`

### 4. لینک‌های بررسی وضعیت
- Health Check: `http://192.168.88.250:8080/health`
- Video API: `http://192.168.88.250:8080/api/videos`
- Web Controller: `http://192.168.88.250:3000`

---

## 📝 فایل‌های لاگ

لاگ‌ها در پوشه `logs/` ذخیره می‌شوند:

```
logs/
├── websocket-server.log    # لاگ سرور WebSocket
└── web-controller.log       # لاگ وب کنترلر
```

### مشاهده لاگ‌ها:

**Mac/Linux:**
```bash
# لاگ WebSocket
tail -f logs/websocket-server.log

# لاگ Web Controller
tail -f logs/web-controller.log
```

**Windows:**
```cmd
REM لاگ WebSocket
type logs\websocket-server.log

REM لاگ Web Controller
type logs\web-controller.log
```

---

## ⚙️ جزئیات فنی

### نصب خودکار Dependencies:
اسکریپت قبل از شروع، بررسی می‌کند که `node_modules` وجود دارد یا نه:

**اگر وجود نداشته باشد:**
```
📦 Checking dependencies...
   Installing server dependencies...
   ✅ Dependencies installed
```

**اگر وجود داشته باشد:**
```
📦 Checking dependencies...
   ✅ Dependencies already installed
```

این یعنی:
- ✅ **اولین بار اجرا:** `npm install` خودکار اجرا می‌شود
- ✅ **بار دوم به بعد:** فوری شروع می‌شود (بدون نصب مجدد)
- ✅ **بعد از `git clone`:** خودکار dependencies نصب می‌شود
- ✅ **بعد از پاک کردن `node_modules`:** دوباره نصب می‌شود

### پورت‌های استفاده شده:
- **8080**: WebSocket Server (برای ارتباط دستگاه‌ها)
- **3000**: Web Controller (برای نمایش رابط کاربری)

### قابلیت‌ها:
- ✅ تشخیص خودکار IP آدرس
- ✅ نصب خودکار dependencies (اگر نیاز باشد)
- ✅ بستن خودکار پروسس‌های قبلی
- ✅ ذخیره لاگ‌ها
- ✅ نمایش همه آدرس‌های لازم
- ✅ بررسی وضعیت سرورها

### الزامات:
- Node.js نصب شده باشد
- پورت‌های 8080 و 3000 آزاد باشند
- همه دستگاه‌ها روی یک شبکه WiFi باشند

---

## 🔧 عیب‌یابی

### اگر سرورها شروع نشدند:

**1. بررسی Node.js:**
```bash
node --version
npm --version
```

**2. بررسی وابستگی‌ها:**
```bash
cd server
npm install
```

**3. بررسی پورت‌ها:**

Mac/Linux:
```bash
lsof -i :8080
lsof -i :3000
```

Windows:
```cmd
netstat -ano | findstr :8080
netstat -ano | findstr :3000
```

**4. مشاهده لاگ‌ها:**
```bash
cat logs/websocket-server.log
cat logs/web-controller.log
```

### اگر IP آدرس نادرست است:

اسکریپت به طور خودکار IP را تشخیص می‌دهد، اما اگر مشکلی بود:

**Mac/Linux:**
```bash
ifconfig | grep "inet "
```

**Windows:**
```cmd
ipconfig
```

و آدرس IP خود را یادداشت کنید.

---

## 📖 مراحل کامل استفاده

### مرحله ۱: شروع سرورها
```bash
./start-all.sh
```

### مرحله ۲: یادداشت آدرس‌ها
اسکریپت آدرس‌ها را نمایش می‌دهد:
- آدرس وب اپ: `http://192.168.88.250:3000`
- آدرس WebSocket: `ws://192.168.88.250:8080`

### مرحله ۳: اتصال از موبایل
1. موبایل را به همان WiFi متصل کنید
2. مرورگر را باز کنید
3. آدرس وب اپ را وارد کنید
4. در وب اپ، آدرس WebSocket را در قسمت "Server Connection" وارد کنید
5. روی Connect کلیک کنید

### مرحله ۴: اتصال Vision Pro
1. اپلیکیشن Vision Pro را باز کنید
2. به Settings بروید
3. آدرس WebSocket را وارد کنید
4. ذخیره و اتصال

### مرحله ۵: توقف (وقتی کار تمام شد)
```bash
./stop-all.sh
```

---

## 🎯 نکات مهم

1. ✅ **همیشه از همان WiFi استفاده کنید** برای همه دستگاه‌ها
2. ✅ **فایروال را بررسی کنید** اگر اتصال برقرار نمی‌شود
3. ✅ **لاگ‌ها را چک کنید** اگر مشکلی بود
4. ✅ **قبل از شروع مجدد، سرورها را متوقف کنید**

---

## 🚀 دستورات سریع

```bash
# شروع
./start-all.sh

# توقف
./stop-all.sh

# مشاهده لاگ‌ها
tail -f logs/websocket-server.log

# تست اتصال
curl http://localhost:8080/health
curl http://localhost:8080/api/videos
curl http://localhost:3000
```

---

**موفق باشید!** 🎉

برای سوالات بیشتر، به فایل‌های زیر مراجعه کنید:
- `README.md` - راهنمای کامل پروژه
- `NETWORK_SETUP.md` - راهنمای راه‌اندازی شبکه
- `IMPLEMENTATION_SUMMARY.md` - خلاصه پیاده‌سازی

